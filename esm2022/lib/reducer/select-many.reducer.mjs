import { EntityActionTypes } from '../actions/action-types';
import { safeGetKey, setNewState } from './reduction.utils';
export const selectManyReducer = ({ state, action, stateName, featureName, entityState }) => {
    switch (action.actionType) {
        case EntityActionTypes.SelectMany: {
            const selectManyEntities = action.entities || [];
            const selectingEntities = Array.isArray(selectManyEntities) ? selectManyEntities : [];
            const selectManyKeys = selectingEntities.map(entity => safeGetKey(action, entity));
            const newState = {
                ...entityState,
                selections: {
                    ...(entityState.selections ?? {}),
                    currentEntitiesKeys: selectManyKeys
                }
            };
            const next = setNewState(featureName, stateName, state, newState);
            return next;
        }
        case EntityActionTypes.SelectMore: {
            const selectMoreEntities = action.entities || [];
            const selectingEntities = Array.isArray(selectMoreEntities) ? selectMoreEntities : [];
            const selectMoreKeys = selectingEntities.map(entity => safeGetKey(action, entity));
            const selectMoreCurrentKeys = entityState.selections?.currentEntitiesKeys || [];
            const selectMoreCombinedKeys = new Set([...selectMoreCurrentKeys, ...selectMoreKeys]);
            const newState = {
                ...entityState,
                selections: {
                    ...(entityState.selections ?? {}),
                    currentEntitiesKeys: [...selectMoreCombinedKeys]
                }
            };
            const next = setNewState(featureName, stateName, state, newState);
            return next;
        }
        case EntityActionTypes.SelectManyByKeys: {
            const selectManyByKeysKeys = action.entitiesKeys || [];
            const selectManyByKeysGuaranteedKeys = Array.isArray(selectManyByKeysKeys) ? selectManyByKeysKeys : [];
            const newState = {
                ...entityState,
                selections: {
                    ...(entityState.selections ?? {}),
                    currentEntitiesKeys: selectManyByKeysGuaranteedKeys
                }
            };
            const next = setNewState(featureName, stateName, state, newState);
            return next;
        }
        case EntityActionTypes.SelectMoreByKeys: {
            const selectMoreByKeysKeys = action.entitiesKeys || [];
            const selectMoreByKeysGuaranteedKeys = Array.isArray(selectMoreByKeysKeys) ? selectMoreByKeysKeys : [];
            const selectMoreByKeysCurrentKeys = entityState.selections?.currentEntitiesKeys || [];
            const selectMoreByKeysCombinedKeys = new Set([...selectMoreByKeysCurrentKeys, ...selectMoreByKeysGuaranteedKeys]);
            const newState = {
                ...entityState,
                selections: {
                    ...(entityState.selections ?? {}),
                    currentEntitiesKeys: [...selectMoreByKeysCombinedKeys]
                }
            };
            const next = setNewState(featureName, stateName, state, newState);
            return next;
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LW1hbnkucmVkdWNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25ncngtYXV0by1lbnRpdHkvc3JjL2xpYi9yZWR1Y2VyL3NlbGVjdC1tYW55LnJlZHVjZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFJNUQsT0FBTyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUU1RCxNQUFNLENBQUMsTUFBTSxpQkFBaUIsR0FBRyxDQUFDLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBa0IsRUFBRSxFQUFFO0lBQzFHLFFBQVEsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQzFCLEtBQUssaUJBQWlCLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNsQyxNQUFNLGtCQUFrQixHQUFJLE1BQTBCLENBQUMsUUFBUSxJQUFJLEVBQUUsQ0FBQztZQUN0RSxNQUFNLGlCQUFpQixHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUN0RixNQUFNLGNBQWMsR0FBRyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDbkYsTUFBTSxRQUFRLEdBQXNCO2dCQUNsQyxHQUFHLFdBQVc7Z0JBQ2QsVUFBVSxFQUFFO29CQUNWLEdBQUcsQ0FBQyxXQUFXLENBQUMsVUFBVSxJQUFJLEVBQUUsQ0FBQztvQkFDakMsbUJBQW1CLEVBQUUsY0FBYztpQkFDcEM7YUFDRixDQUFDO1lBRUYsTUFBTSxJQUFJLEdBQUcsV0FBVyxDQUFDLFdBQVcsRUFBRSxT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RSxRQUFRLENBQUMsQ0FBQztZQUNsRSxPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7SUFDSCxDQUFDO0FBQ0gsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRW50aXR5QWN0aW9uVHlwZXMgfSBmcm9tICcuLi9hY3Rpb25zL2FjdGlvbi10eXBlcyc7XG5pbXBvcnQgeyBTZWxlY3RNYW55LCBTZWxlY3RNYW55QnlLZXlzLCBTZWxlY3RNb3JlLCBTZWxlY3RNb3JlQnlLZXlzIH0gZnJvbSAnLi4vYWN0aW9ucy9zZWxlY3Rpb24tYWN0aW9ucyc7XG5pbXBvcnQgeyBJRW50aXR5U3RhdGUgfSBmcm9tICcuLi91dGlsL2VudGl0eS1zdGF0ZSc7XG5pbXBvcnQgeyBSZWR1Y3Rpb25CYXNpcyB9IGZyb20gJy4vcmVkdWNlcic7XG5pbXBvcnQgeyBzYWZlR2V0S2V5LCBzZXROZXdTdGF0ZSB9IGZyb20gJy4vcmVkdWN0aW9uLnV0aWxzJztcblxuZXhwb3J0IGNvbnN0IHNlbGVjdE1hbnlSZWR1Y2VyID0gKHsgc3RhdGUsIGFjdGlvbiwgc3RhdGVOYW1lLCBmZWF0dXJlTmFtZSwgZW50aXR5U3RhdGUgfTogUmVkdWN0aW9uQmFzaXMpID0+IHtcbiAgc3dpdGNoIChhY3Rpb24uYWN0aW9uVHlwZSkge1xuICAgIGNhc2UgRW50aXR5QWN0aW9uVHlwZXMuU2VsZWN0TWFueToge1xuICAgICAgY29uc3Qgc2VsZWN0TWFueUVudGl0aWVzID0gKGFjdGlvbiBhcyBTZWxlY3RNYW55PGFueT4pLmVudGl0aWVzIHx8IFtdO1xuICAgICAgY29uc3Qgc2VsZWN0aW5nRW50aXRpZXMgPSBBcnJheS5pc0FycmF5KHNlbGVjdE1hbnlFbnRpdGllcykgPyBzZWxlY3RNYW55RW50aXRpZXMgOiBbXTtcbiAgICAgIGNvbnN0IHNlbGVjdE1hbnlLZXlzID0gc2VsZWN0aW5nRW50aXRpZXMubWFwKGVudGl0eSA9PiBzYWZlR2V0S2V5KGFjdGlvbiwgZW50aXR5KSk7XG4gICAgICBjb25zdCBuZXdTdGF0ZTogSUVudGl0eVN0YXRlPGFueT4gPSB7XG4gICAgICAgIC4uLmVudGl0eVN0YXRlLFxuICAgICAgICBzZWxlY3Rpb25zOiB7XG4gICAgICAgICAgLi4uKGVudGl0eVN0YXRlLnNlbGVjdGlvbnMgPz8ge30pLFxuICAgICAgICAgIGN1cnJlbnRFbnRpdGllc0tleXM6IHNlbGVjdE1hbnlLZXlzXG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG5leHQgPSBzZXROZXdTdGF0ZShmZWF0dXJlTmFtZSwgc3RhdGVOYW1lLCBzdGF0ZSwgbmV3U3RhdGUpO1xuICAgICAgcmV0dXJuIG5leHQ7XG4gICAgfVxuICAgIGNhc2UgRW50aXR5QWN0aW9uVHlwZXMuU2VsZWN0TW9yZToge1xuICAgICAgY29uc3Qgc2VsZWN0TW9yZUVudGl0aWVzID0gKGFjdGlvbiBhcyBTZWxlY3RNb3JlPGFueT4pLmVudGl0aWVzIHx8IFtdO1xuICAgICAgY29uc3Qgc2VsZWN0aW5nRW50aXRpZXMgPSBBcnJheS5pc0FycmF5KHNlbGVjdE1vcmVFbnRpdGllcykgPyBzZWxlY3RNb3JlRW50aXRpZXMgOiBbXTtcbiAgICAgIGNvbnN0IHNlbGVjdE1vcmVLZXlzID0gc2VsZWN0aW5nRW50aXRpZXMubWFwKGVudGl0eSA9PiBzYWZlR2V0S2V5KGFjdGlvbiwgZW50aXR5KSk7XG4gICAgICBjb25zdCBzZWxlY3RNb3JlQ3VycmVudEtleXMgPSBlbnRpdHlTdGF0ZS5zZWxlY3Rpb25zPy5jdXJyZW50RW50aXRpZXNLZXlzIHx8IFtdO1xuICAgICAgY29uc3Qgc2VsZWN0TW9yZUNvbWJpbmVkS2V5cyA9IG5ldyBTZXQoWy4uLnNlbGVjdE1vcmVDdXJyZW50S2V5cywgLi4uc2VsZWN0TW9yZUtleXNdKTtcbiAgICAgIGNvbnN0IG5ld1N0YXRlOiBJRW50aXR5U3RhdGU8YW55PiA9IHtcbiAgICAgICAgLi4uZW50aXR5U3RhdGUsXG4gICAgICAgIHNlbGVjdGlvbnM6IHtcbiAgICAgICAgICAuLi4oZW50aXR5U3RhdGUuc2VsZWN0aW9ucyA/PyB7fSksXG4gICAgICAgICAgY3VycmVudEVudGl0aWVzS2V5czogWy4uLnNlbGVjdE1vcmVDb21iaW5lZEtleXNdXG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG5leHQgPSBzZXROZXdTdGF0ZShmZWF0dXJlTmFtZSwgc3RhdGVOYW1lLCBzdGF0ZSwgbmV3U3RhdGUpO1xuICAgICAgcmV0dXJuIG5leHQ7XG4gICAgfVxuICAgIGNhc2UgRW50aXR5QWN0aW9uVHlwZXMuU2VsZWN0TWFueUJ5S2V5czoge1xuICAgICAgY29uc3Qgc2VsZWN0TWFueUJ5S2V5c0tleXMgPSAoYWN0aW9uIGFzIFNlbGVjdE1hbnlCeUtleXM8YW55PikuZW50aXRpZXNLZXlzIHx8IFtdO1xuICAgICAgY29uc3Qgc2VsZWN0TWFueUJ5S2V5c0d1YXJhbnRlZWRLZXlzID0gQXJyYXkuaXNBcnJheShzZWxlY3RNYW55QnlLZXlzS2V5cykgPyBzZWxlY3RNYW55QnlLZXlzS2V5cyA6IFtdO1xuICAgICAgY29uc3QgbmV3U3RhdGU6IElFbnRpdHlTdGF0ZTxhbnk+ID0ge1xuICAgICAgICAuLi5lbnRpdHlTdGF0ZSxcbiAgICAgICAgc2VsZWN0aW9uczoge1xuICAgICAgICAgIC4uLihlbnRpdHlTdGF0ZS5zZWxlY3Rpb25zID8/IHt9KSxcbiAgICAgICAgICBjdXJyZW50RW50aXRpZXNLZXlzOiBzZWxlY3RNYW55QnlLZXlzR3VhcmFudGVlZEtleXNcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3QgbmV4dCA9IHNldE5ld1N0YXRlKGZlYXR1cmVOYW1lLCBzdGF0ZU5hbWUsIHN0YXRlLCBuZXdTdGF0ZSk7XG4gICAgICByZXR1cm4gbmV4dDtcbiAgICB9XG4gICAgY2FzZSBFbnRpdHlBY3Rpb25UeXBlcy5TZWxlY3RNb3JlQnlLZXlzOiB7XG4gICAgICBjb25zdCBzZWxlY3RNb3JlQnlLZXlzS2V5cyA9IChhY3Rpb24gYXMgU2VsZWN0TW9yZUJ5S2V5czxhbnk+KS5lbnRpdGllc0tleXMgfHwgW107XG4gICAgICBjb25zdCBzZWxlY3RNb3JlQnlLZXlzR3VhcmFudGVlZEtleXMgPSBBcnJheS5pc0FycmF5KHNlbGVjdE1vcmVCeUtleXNLZXlzKSA/IHNlbGVjdE1vcmVCeUtleXNLZXlzIDogW107XG4gICAgICBjb25zdCBzZWxlY3RNb3JlQnlLZXlzQ3VycmVudEtleXMgPSBlbnRpdHlTdGF0ZS5zZWxlY3Rpb25zPy5jdXJyZW50RW50aXRpZXNLZXlzIHx8IFtdO1xuICAgICAgY29uc3Qgc2VsZWN0TW9yZUJ5S2V5c0NvbWJpbmVkS2V5cyA9IG5ldyBTZXQoWy4uLnNlbGVjdE1vcmVCeUtleXNDdXJyZW50S2V5cywgLi4uc2VsZWN0TW9yZUJ5S2V5c0d1YXJhbnRlZWRLZXlzXSk7XG4gICAgICBjb25zdCBuZXdTdGF0ZTogSUVudGl0eVN0YXRlPGFueT4gPSB7XG4gICAgICAgIC4uLmVudGl0eVN0YXRlLFxuICAgICAgICBzZWxlY3Rpb25zOiB7XG4gICAgICAgICAgLi4uKGVudGl0eVN0YXRlLnNlbGVjdGlvbnMgPz8ge30pLFxuICAgICAgICAgIGN1cnJlbnRFbnRpdGllc0tleXM6IFsuLi5zZWxlY3RNb3JlQnlLZXlzQ29tYmluZWRLZXlzXVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBuZXh0ID0gc2V0TmV3U3RhdGUoZmVhdHVyZU5hbWUsIHN0YXRlTmFtZSwgc3RhdGUsIG5ld1N0YXRlKTtcbiAgICAgIHJldHVybiBuZXh0O1xuICAgIH1cbiAgfVxufTtcbiJdfQ==