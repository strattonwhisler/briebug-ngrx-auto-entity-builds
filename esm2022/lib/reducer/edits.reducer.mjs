import { EntityActionTypes } from '../actions/action-types';
import { getKey } from '../decorators/key-util';
import { safeGetKey, setNewState } from './reduction.utils';
export const editsReducer = ({ state, action, stateName, featureName, entityState }) => {
    switch (action.actionType) {
        case EntityActionTypes.EditNew: {
            const editEntity = action.entity || {};
            if (!editEntity) {
                return state;
            }
            const newState = {
                ...entityState,
                edits: {
                    editedEntity: { ...editEntity }, // TODO: Figure out a deep clone option here!!
                    isDirty: false
                }
            };
            const next = setNewState(featureName, stateName, state, newState);
            return next;
        }
        case EntityActionTypes.Edit: {
            const editEntity = action.entity;
            if (!editEntity) {
                return state;
            }
            const editedKey = safeGetKey(action, editEntity);
            const prevEditedKey = entityState.edits?.editedEntity && getKey(action, entityState.edits.editedEntity);
            if (editedKey === prevEditedKey) {
                return state;
            }
            const newState = {
                ...entityState,
                edits: {
                    editedEntity: { ...editEntity }, // TODO: Figure out a deep clone option here!!
                    isDirty: false
                }
            };
            const next = setNewState(featureName, stateName, state, newState);
            return next;
        }
        case EntityActionTypes.EditByKey: {
            const editedKey = action.key;
            const prevEditedKey = entityState.edits?.editedEntity && getKey(action, entityState.edits.editedEntity);
            if (!editedKey || editedKey === prevEditedKey) {
                return state;
            }
            const editEntity = entityState.entities[editedKey];
            if (!editEntity) {
                return state;
            }
            const newState = {
                ...entityState,
                edits: {
                    editedEntity: { ...editEntity }, // TODO: Figure out a deep clone option here!!
                    isDirty: false
                }
            };
            const next = setNewState(featureName, stateName, state, newState);
            return next;
        }
        case EntityActionTypes.Change: {
            const changeEntity = action.entity;
            if (!changeEntity || !entityState.edits?.editedEntity) {
                return state;
            }
            const newState = {
                ...entityState,
                edits: {
                    editedEntity: { ...changeEntity }, // TODO: Figure out a deep clone option here!!
                    isDirty: true
                }
            };
            const next = setNewState(featureName, stateName, state, newState);
            return next;
        }
        case EntityActionTypes.EndEdit: {
            if (entityState.edits?.editedEntity === undefined) {
                return state;
            }
            const newState = {
                ...entityState,
                edits: {
                    editedEntity: undefined,
                    isDirty: undefined
                }
            };
            const next = setNewState(featureName, stateName, state, newState);
            return next;
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdHMucmVkdWNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25ncngtYXV0by1lbnRpdHkvc3JjL2xpYi9yZWR1Y2VyL2VkaXRzLnJlZHVjZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFNUQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBR2hELE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFNUQsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsV0FBVyxFQUFrQixFQUFFLEVBQUU7SUFDckcsUUFBUSxNQUFNLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDMUIsS0FBSyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQy9CLE1BQU0sVUFBVSxHQUFJLE1BQXVCLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQztZQUN6RCxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBQ2hCLE9BQU8sS0FBSyxDQUFDO1lBQ2YsQ0FBQztZQUVELE1BQU0sUUFBUSxHQUFzQjtnQkFDbEMsR0FBRyxXQUFXO2dCQUNkLEtBQUssRUFBRTtvQkFDTCxZQUFZLEVBQUUsRUFBRSxHQUFHLFVBQVUsRUFBRSxFQUFFLDhDQUE4QztvQkFDL0UsT0FBTyxFQUFFLEtBQUs7aUJBQ2Y7YUFDRixDQUFDO1lBRUYsTUFBTSxJQUFJLEdBQUcsV0FBVyxDQUFDLFdBQVcsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQ2xFLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUNELEtBQUssaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUM1QixNQUFN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QVc7Z0JBQ2QsS0FBSyxFQUFFO29CQUNMLFlBQVksRUFBRSxTQUFTO29CQUN2QixPQUFPLEVBQUUsU0FBUztpQkFDbkI7YUFDRixDQUFDO1lBRUYsTUFBTSxJQUFJLEdBQUcsV0FBVyxDQUFDLFdBQVcsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQ2xFLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7QUFDSCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbnRpdHlBY3Rpb25UeXBlcyB9IGZyb20gJy4uL2FjdGlvbnMvYWN0aW9uLXR5cGVzJztcbmltcG9ydCB7IENoYW5nZSwgRWRpdCwgRWRpdEJ5S2V5LCBFZGl0TmV3IH0gZnJvbSAnLi4vYWN0aW9ucy9lZGl0LWFjdGlvbnMnO1xuaW1wb3J0IHsgZ2V0S2V5IH0gZnJvbSAnLi4vZGVjb3JhdG9ycy9rZXktdXRpbCc7XG5pbXBvcnQgeyBJRW50aXR5U3RhdGUgfSBmcm9tICcuLi91dGlsL2VudGl0eS1zdGF0ZSc7XG5pbXBvcnQgeyBSZWR1Y3Rpb25CYXNpcyB9IGZyb20gJy4vcmVkdWNlcic7XG5pbXBvcnQgeyBzYWZlR2V0S2V5LCBzZXROZXdTdGF0ZSB9IGZyb20gJy4vcmVkdWN0aW9uLnV0aWxzJztcblxuZXhwb3J0IGNvbnN0IGVkaXRzUmVkdWNlciA9ICh7IHN0YXRlLCBhY3Rpb24sIHN0YXRlTmFtZSwgZmVhdHVyZU5hbWUsIGVudGl0eVN0YXRlIH06IFJlZHVjdGlvbkJhc2lzKSA9PiB7XG4gIHN3aXRjaCAoYWN0aW9uLmFjdGlvblR5cGUpIHtcbiAgICBjYXNlIEVudGl0eUFjdGlvblR5cGVzLkVkaXROZXc6IHtcbiAgICAgIGNvbnN0IGVkaXRFbnRpdHkgPSAoYWN0aW9uIGFzIEVkaXROZXc8YW55PikuZW50aXR5IHx8IHt9O1xuICAgICAgaWYgKCFlZGl0RW50aXR5KSB7XG4gICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbmV3U3RhdGU6IElFbnRpdHlTdGF0ZTxhbnk+ID0ge1xuICAgICAgICAuLi5lbnRpdHlTdGF0ZSxcbiAgICAgICAgZWRpdHM6IHtcbiAgICAgICAgICBlZGl0ZWRFbnRpdHk6IHsgLi4uZWRpdEVudGl0eSB9LCAvLyBUT0RPOiBGaWd1cmUgb3V0IGEgZGVlcCBjbG9uZSBvcHRpb24gaGVyZSEhXG4gICAgICAgICAgaXNEaXJ0eTogZmFsc2VcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3QgbmV4dCA9IHNldE5ld1N0YXRlKGZlYXR1cmVOYW1lLCBzdGF0ZU5hbWUsIHN0YXRlLCBuZXdTdGF0ZSk7XG4gICAgICByZXR1cm4gbmV4dDtcbiAgICB9XG4gICAgY2FzZSBFbnRpdHlBY3Rpb25UeXBlcy5FZGl0OiB7XG4gICAgICBjb25zdCBlZGl0RW50aXR5ID0gKGFjdGlvbiBhcyBFZGl0PGFueT4pLmVudGl0eTtcbiAgICAgIGlmICghZWRpdEVudGl0eSkge1xuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVkaXRlZEtleSA9IHNhZmVHZXRLZXkoYWN0aW9uLCBlZGl0RW50aXR5KTtcbiAgICAgIGNvbnN0IHByZXZFZGl0ZWRLZXkgPSBlbnRpdHlTdGF0ZS5lZGl0cz8uZWRpdGVkRW50aXR5ICYmIGdldEtleShhY3Rpb24sIGVudGl0eVN0YXRlLmVkaXRzLmVkaXRlZEVudGl0eSk7XG4gICAgICBpZiAoZWRpdGVkS2V5ID09PSBwcmV2RWRpdGVkS2V5KSB7XG4gICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbmV3U3RhdGU6IElFbnRpdHlTdGF0ZTxhbnk+ID0ge1xuICAgICAgICAuLi5lbnRpdHlTdGF0ZSxcbiAgICAgICAgZWRpdHM6IHtcbiAgICAgICAgICBlZGl0ZWRFbnRpdHk6IHsgLi4uZWRpdEVudGl0eSB9LCAvLyBUT0RPOiBGaWd1cmUgb3V0IGEgZGVlcCBjbG9uZSBvcHRpb24gaGVyZSEhXG4gICAgICAgICAgaXNEaXJ0eTogZmFsc2VcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3QgbmV4dCA9IHNldE5ld1N0YXRlKGZlYXR1cmVOYW1lLCBzdGF0ZU5hbWUsIHN0YXRlLCBuZXdTdGF0ZSk7XG4gICAgICByZXR1cm4gbmV4dDtcbiAgICB9XG4gICAgY2FzZSBFbnRpdHlBY3Rpb25UeXBlcy5FZGl0QnlLZXk6IHtcbiAgICAgIGNvbnN0IGVkaXRlZEtleSA9IChhY3Rpb24gYXMgRWRpdEJ5S2V5PGFueT4pLmtleTtcbiAgICAgIGNvbnN0IHByZXZFZGl0ZWRLZXkgPSBlbnRpdHlTdGF0ZS5lZGl0cz8uZWRpdGVkRW50aXR5ICYmIGdldEtleShhY3Rpb24sIGVudGl0eVN0YXRlLmVkaXRzLmVkaXRlZEVudGl0eSk7XG4gICAgICBpZiAoIWVkaXRlZEtleSB8fCBlZGl0ZWRLZXkgPT09IHByZXZFZGl0ZWRLZXkpIHtcbiAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBlZGl0RW50aXR5ID0gZW50aXR5U3RhdGUuZW50aXRpZXNbZWRpdGVkS2V5XTtcbiAgICAgIGlmICghZWRpdEVudGl0eSkge1xuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG5ld1N0YXRlOiBJRW50aXR5U3RhdGU8YW55PiA9IHtcbiAgICAgICAgLi4uZW50aXR5U3RhdGUsXG4gICAgICAgIGVkaXRzOiB7XG4gICAgICAgICAgZWRpdGVkRW50aXR5OiB7IC4uLmVkaXRFbnRpdHkgfSwgLy8gVE9ETzogRmlndXJlIG91dCBhIGRlZXAgY2xvbmUgb3B0aW9uIGhlcmUhIVxuICAgICAgICAgIGlzRGlydHk6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG5leHQgPSBzZXROZXdTdGF0ZShmZWF0dXJlTmFtZSwgc3RhdGVOYW1lLCBzdGF0ZSwgbmV3U3RhdGUpO1xuICAgICAgcmV0dXJuIG5leHQ7XG4gICAgfVxuICAgIGNhc2UgRW50aXR5QWN0aW9uVHlwZXMuQ2hhbmdlOiB7XG4gICAgICBjb25zdCBjaGFuZ2VFbnRpdHkgPSAoYWN0aW9uIGFzIENoYW5nZTxhbnk+KS5lbnRpdHk7XG4gICAgICBpZiAoIWNoYW5nZUVudGl0eSB8fCAhZW50aXR5U3RhdGUuZWRpdHM/LmVkaXRlZEVudGl0eSkge1xuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG5ld1N0YXRlOiBJRW50aXR5U3RhdGU8YW55PiA9IHtcbiAgICAgICAgLi4uZW50aXR5U3RhdGUsXG4gICAgICAgIGVkaXRzOiB7XG4gICAgICAgICAgZWRpdGVkRW50aXR5OiB7IC4uLmNoYW5nZUVudGl0eSB9LCAvLyBUT0RPOiBGaWd1cmUgb3V0IGEgZGVlcCBjbG9uZSBvcHRpb24gaGVyZSEhXG4gICAgICAgICAgaXNEaXJ0eTogdHJ1ZVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBuZXh0ID0gc2V0TmV3U3RhdGUoZmVhdHVyZU5hbWUsIHN0YXRlTmFtZSwgc3RhdGUsIG5ld1N0YXRlKTtcbiAgICAgIHJldHVybiBuZXh0O1xuICAgIH1cbiAgICBjYXNlIEVudGl0eUFjdGlvblR5cGVzLkVuZEVkaXQ6IHtcbiAgICAgIGlmIChlbnRpdHlTdGF0ZS5lZGl0cz8uZWRpdGVkRW50aXR5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBuZXdTdGF0ZTogSUVudGl0eVN0YXRlPGFueT4gPSB7XG4gICAgICAgIC4uLmVudGl0eVN0YXRlLFxuICAgICAgICBlZGl0czoge1xuICAgICAgICAgIGVkaXRlZEVudGl0eTogdW5kZWZpbmVkLFxuICAgICAgICAgIGlzRGlydHk6IHVuZGVmaW5lZFxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBuZXh0ID0gc2V0TmV3U3RhdGUoZmVhdHVyZU5hbWUsIHN0YXRlTmFtZSwgc3RhdGUsIG5ld1N0YXRlKTtcbiAgICAgIHJldHVybiBuZXh0O1xuICAgIH1cbiAgfVxufTtcbiJdfQ==